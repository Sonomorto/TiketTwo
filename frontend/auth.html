<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventHub - Accesso</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <h1 class="logo">üéüÔ∏è EventHub</h1>
            <a href="/" class="nav-item">Torna alla Home</a>
        </nav>
    </header>

    <main class="auth-container">
        <div class="auth-tabs">
            <button class="tab-btn active" data-tab="login">Login</button>
            <button class="tab-btn" data-tab="register">Registrati</button>
        </div>

        <!-- Form Login -->
        <form id="loginForm" class="auth-form active">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required>
            </div>

            <button type="submit" class="auth-btn">Accedi</button>
        </form>

        <!-- Form Registrazione -->
        <form id="registerForm" class="auth-form">
            <div class="form-group">
                <label for="registerName">Nome completo</label>
                <input type="text" id="registerName" required>
            </div>

            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            
            <div class="form-group">
                <label for="registerPassword">Password (min. 8 caratteri)</label>
                <input type="password" id="registerPassword" minlength="8" required>
            </div>

            <button type="submit" class="auth-btn">Crea account</button>
        </form>

        <div id="authMessage" class="auth-message"></div>
    </main>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api/v1';
        
        // Gestione tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.auth-form, .tab-btn').forEach(el => {
                    el.classList.remove('active');
                });
                btn.classList.add('active');
                document.getElementById(`${tab}Form`).classList.add('active');
            });
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (!response.ok) throw new Error(data.message || 'Errore nel login');
                
                localStorage.setItem('token', data.token);
                window.location.href = '/dashboard.html';
            } catch (error) {
                showMessage(error.message, 'error');
            }
        });

        // Registrazione
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                
                if (!response.ok) throw new Error(data.message || 'Registrazione fallita');
                
                showMessage('Registrazione completata! Effettua il login', 'success');
                document.querySelector('[data-tab="login"]').click();
                e.target.reset();
            } catch (error) {
                showMessage(error.message, 'error');
            }
        });

        // Mostra messaggi
        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = text;
            messageEl.className = `auth-message ${type}`;
            setTimeout(() => messageEl.textContent = '', 5000);
        }
    </script>
</body>
</html>